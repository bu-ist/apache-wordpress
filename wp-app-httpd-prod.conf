# /etc/httpd/conf.d/wp-app-httpd-prod.conf
#
# Modular Apache configuration file for WordPress in the test landscape.
#
# Contains VirtualHost definitions for port 80 (http) and 443 (https), with the 443
# block added to replication what's in the 80 block, and add needed SSL directives.
# In conformance with industry direction, IS&T seeks to ultimately eliminate http
# access to our websites.  At that time we can probably largely eliminate VirtualHost
# usage, and just allow the standard ssl.conf file to cover https access.
#
# HISTORY:  2019/07/--  Now has parallel 80 & 443 VirtualHost blocks, in pursuing INC12524335,
#			with an ultimate goal of forcing use of protocol https.  rbs
#

#LogLevel debug

ScoreboardFile /var/log/httpd/wp-app-prod-apache_runtime_status

# Expiration added *2017-10-06* as per INC12280711
<IfModule mod_expires.c>
  # Enable expirations
  ExpiresActive On
  ExpiresByType image/x-icon "access plus 1 year"
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/jpg "access plus 1 month"
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType text/css "access 1 month"
  ExpiresByType text/javascript "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
</IfModule>

<IfModule mod_setenvif.c>
  # ####
  # The following directive disables keepalives and HTTP header flushes for
  # Netscape 2.x and browsers which spoof it. There are known problems with
  # these browsers.
  BrowserMatch Mozilla/2 nokeepalive

  # ####
  # The following directive forces the response to be HTTP 1.0 even if
  # the request is HTTP 1.1 for Java 1.0 code as it will confuse the
  # Java 1.0 classes.
  #BrowserMatch "RealPlayer 4\.0" force-response-1.0
  #BrowserMatch "JDK/1\.0" force-response-1.0
  BrowserMatch Java1.0 force-response-1.0

</IfModule>

##########################################################################
# weblogin configuration information
##########################################################################
<IfModule mod_auth_weblogin5.c>

 # These match browsers that do not work well with the old style
 # system
 #
 # Netscape 6.x on any platform does not work at all
 BrowserMatch "^Mozilla/5" weblogin_method=redirect
 # Mac IE does not handle reauthentication well.
 #BrowserMatch "MSIE.*Mac" weblogin_method=redirect

 # ####
 # WEBLOGIN is a macro which defaults to 'weblogin'.  May be defined in server:host file as
 # weblogin-test (www-test && www-devl) || weblogin2 (www-syst)

 
 WebloginApp "https://weblogin.bu.edu/web@login3"

 # The following commands are no longer used with mod_auth_weblogin5
 # WebloginKAuthURI, WebloginOAuthURI, WebloginBothAuthURI
 # WebloginServers, WebloginACLServers
 # WebloginRedirect
 # -dsmk 6/29/2006

 # This command is still used since we still use the NoCookieURI
 # even with redirect-based authentication
 WebloginNoCookieURI /weblogin/v3/nocookie.html

  # WEBLOGINLABEL not set
 
 # output timing info in error logs -dsmk 3/29/99
 WebloginTiming on

 # 
 # debugging options
 # LogLevel not set (debug)
 #WebloginDebug not set. Values ::= (5, 102, ...)
 #WebloginCusspDebug not set. Values ::= (0,1,2)

</IfModule>

#CGI_LIB is the location where CGI libraries are found.  Redefine
#the CGILIB macro to over-ride default value (DROOT/web/lib)
# alternate values ::= DROOT/web/lib/test_uisint || DROOT/web/lib/test

<IfModule mod_perl.c>
 PerlSetEnv webloginserver "https://weblogin.bu.edu/web@login3"
# PerlSetEnv CGI_LIB "/var/www/cms-prod/current/web/lib"
</IfModule>

<IfModule mod_env.c>
 SetEnv webloginserver "https://weblogin.bu.edu/web@login3"
# SetEnv CGI_LIB "/var/www/cms-prod/current/web/lib"
 # Perl scripts should automatically include CGILIB
# SetEnv PERL5LIB "/var/www/cms-prod/current/web/lib"
</IfModule>

####
# Disallow serving support type directories
#
RewriteRule /\.(svn|git|snapshot)(/|$) - [L,F,E=backend_srv:disallowed-file-extension]
RewriteRule /_admin(/|$) - [L,F,E=backend_srv:disallowed-file-extension]

###<IfDefine Disable>
### RewriteEngine on
### RewriteLog /var/log/httpd/rewrite_log
###</IfDefine>

AccessFileName .htaccess

# DirectoryIndex: Name of the file or files to use as a pre-written HTML
# directory index.  Separate multiple entries with spaces.
DirectoryIndex index.html index.htm index.shtml index.php


##########################################################################
# default php configuration  (if PHPVER macro is defined)
#
###  <IfModule mod_php4.c>
###    php_admin_value default_socket_timeout 120
###    php_admin_value mysql.connect_timeout 120
###  </IfModule>

###  <IfModule mod_php4.c>
###    php_admin_value include_path .:/usr/share/pear
###  </IfModule>

<IfModule php7_module>

   # PHP_SAFEMODE not set

   # set a custom error reporting level
   php_admin_value error_reporting 6135
   # set a maximum amount of memory that a php script can use.
   php_admin_value memory_limit 256M
   # set a max upload size (other than the default value)
   php_admin_value post_max_size 100M
   # set a max upload size (other than the default value)
   php_admin_value upload_max_filesize 100M
   # set the directory for temporary files
   php_admin_value upload_tmp_dir /tmp
   # PHP_IGNORE_REFERENCE_ERRORS set
   php_admin_flag  allow_call_time_pass_reference on

</IfModule>

##########################################################################
# status systems
#
#
# The following Location sections could be a security hole
# if you do not with the whole world to know who is accessing what
# pages on your server when, and other details about the server. 
# It is highly suggested that you limit access
# to these locations. 

# ####
# all server status systems are protected
#
<IfDefine !nostatus>
  # apache startup
  Alias /server/startup /var/run/apache_wp-app-prod
# ADAPT this
  Alias /server/configuration /usr/local/apache/wp-app-prod/conf/wp-app-prod.conf:ist-wp-app.bu.edu

  RewriteRule ^/server$ /usr/local/apache/wp-app-prod/bin/srvbin/serverinfo [L,H=cgi-script]

  #LogLevel debug   

  # apache status
  <IfModule mod_status.c>
    <Location /server/status>
      SetHandler server-status
    </Location>
    ExtendedStatus on
  </IfModule>

  # apache info
  <IfModule mod_info.c>
    <Location /server/info>
      SetHandler server-info
    </Location>
  </IfModule>

  # mod_proxy
  <IfModule proxy_balancer_module>
    <Location /server/balancer>
      # since we can modify balancer rankings we have stricter security
      #Satisfy all
      SetHandler balancer-manager
    </Location>
  </IfModule>
  
  # mod_perl info
  <IfModule mod_perl.c>
    <Location /server/perl-status>
      SetHandler perl-script
      PerlHandler Apache2::Status
    </Location>
  </IfModule>

  # ssl info
  <IfModule mod_ssl.c>
    <Location /server/ssl-sessions>
      SetHandler ssl-session-info
    </Location>
  </IfModule>

  # backhand status
###  <IfModule mod_backhand.c>
###     <Location /server/backhand>
###        SetHandler backhand-handler
###     </Location>
###  </IfModule>

  # throttle status
  <IfModule mod_throttle.c>
    # complete throttle list
    <Location /server/throttle-status>
      SetHandler throttle-status
    </Location>

    # remote user throttle status
    <Location /server/throttle-users>
      SetHandler throttle-remote-user
    </Location>

    # complete client-IP list
    <Location /server/throttle-client>
      SetHandler throttle-client-ip
    </Location>

  </IfModule>

</IfDefine>

# Skipping OITtest area

##########################################################################
##########################################################################
# Server Tuning
##########################################################################
###
# CacheNegotiatedDocs: By default, Apache sends Pragma: no-cache with each
# document that was negotiated on the basis of content. This asks proxy
# servers not to cache the document. Uncommenting the following line disables
# this behavior, and proxies will be allowed to cache the documents.
#
#CacheNegotiatedDocs

# Timeout: The number of seconds before receives and sends time out
#  n.b. the compiled default is 1200 (20 minutes !)
#
Timeout 400

# ListenBackLog Directive: Maximum length of the queue of pending connections.
#

# KeepAlive: The number of Keep-Alive persistent requests to accept
# per connection. Set to 0 to deactivate Keep-Alive support
#
KeepAlive On

# MaxKeepAliveRequests: The maximum number of requests to allow
# during a persistent connection. Set to 0 to allow an unlimited amount.
# We reccomend you leave this number high, for maximum performance.
#
MaxKeepAliveRequests 100

# KeepAliveTimeout: Number of seconds to wait for the next request
#
KeepAliveTimeout 5

# Sendfile appears to have stability issues with AFS under Solaris so we 
# disable it by default.  You can turn it on for particular area by 
# using the EnableSendFile on directive.
EnableSendFile off

# MMap disabled
EnableMMap off

# Server-pool size regulation.  Rather than making you guess how many
# server processes you need, Apache dynamically adapts to the load it
# sees --- that is, it tries to maintain enough server processes to
# handle the current load, plus a few spare servers to handle transient
# load spikes (e.g., multiple simultaneous requests from a single
# Netscape browser).

# It does this by periodically checking how many servers are waiting
# for a request.  If there are fewer than MinSpareServers, it creates
# a new spare.  If there are more than MaxSpareServers, some of the
# spares die off.  These values are probably OK for most sites ---
#

ServerLimit 256
MaxClients 256
StartServers 20
# MPM_TYPE= prefork
MinSpareServers 5
MaxSpareServers 20

# Store coredumps in this directory
CoreDumpDirectory /var/log/httpd 

# The lockfile and acceptmutex are Apache 2.x things
#AcceptMutex fcntl
# LockFile /var/log/apache/wp-app-prod/lockfile

# MaxRequestsPerChild: the number of requests each child process is
#  allowed to process before the child dies.
#  The child will exit so as to avoid problems after prolonged use when
#  Apache (and maybe the libraries it uses) leak.  On most systems, this
#  isn't really needed, but a few (such as Solaris) do have notable leaks
#  in the libraries.
#

MaxRequestsPerChild 200

##########################################################################
# MIME typing
##########################################################################

# DefaultType is the default MIME type for documents which the server
# cannot find the type of from filename extensions.
DefaultType text/plain

# AddEncoding allows you to have certain browsers (Mosaic/X 2.1+) uncompress
# information on the fly. Note: Not all browsers support this.

AddEncoding x-compress Z
AddEncoding x-gzip gz

# AddLanguage allows you to specify the language of a document. You can
# then use content negotiation to give a browser a file in a language
# it can understand.  Note that the suffix does not have to be the same
# as the language keyword --- those with documents in Polish (whose
# net-standard language code is pl) may wish to use "AddLanguage pl .po" 
# to avoid the ambiguity with the common suffix for perl scripts.

AddLanguage en .en
AddLanguage fr .fr
AddLanguage de .de
AddLanguage da .da
AddLanguage el .el
AddLanguage it .it

# LanguagePriority allows you to give precedence to some languages
# in case of a tie during content negotiation.
# Just list the languages in decreasing order of preference.

LanguagePriority en fr de

# AddType allows you to tweak mime.types without actually editing it, or to
# make certain files to be certain types.
# Format: AddType type/subtype ext1
#AddType application/x-tar .tgz

# AddHandler allows you to map certain file extensions to "handlers",
# actions unrelated to filetype. These can be either built into the server
# or added with the Action command (see below)
# Format: AddHandler action-name ext1

# To use CGI scripts:
#AddHandler cgi-script .cgi

#<Location /server-sessions>
#SetHandler ssl-session-info

#order deny,allow
#deny from all
#allow from 128.197.20
#</Location>

##################################################
# Log definitions
##################################################
# we have two versions of the basic access/transfer log depending on
# whether or not we need to store the server IP.  We always log the 
# UNIQUE_ID since it is used by other logs to provide linkage.
#
# There are two versions of these definitions, if the SSL module is 
# loaded then we add a flag at the end to indicate whether or not
# SSL.
#

###    EnableGetTimeofDay on
###    EnableGetRUsage on
###    LogFormat "%h %l %u %t \"%r\" %s %b %<D:%>D %{usercpu}n %{systemcpu}n \"%{Referer}i\" \"%{User-Agent}i\" %P %X %{UNIQUE_ID}e - %{HTTPS}x:%{X-Method}i %{FRONTEND_IP}e" butransfer
###    LogFormat "%h %l %u %t \"%r\" %s %b %<D:%>D %{usercpu}n %{systemcpu}n \"%{Referer}i\" \"%{User-Agent}i\" %P %X %{UNIQUE_ID}e %A %{HTTPS}x:%{X-Method}i" butransfer_ip
###    LogFormat "%h %l %u %t \"%r\" %s %b %<D:%>D %{usercpu}n %{systemcpu}n \"%{Referer}i\" \"%{User-Agent}i\" %P %X %{UNIQUE_ID}e %A %{HTTPS}x:%{X-Method}i %v %{Host}i" butransfer_virtual
###    LogFormat "%h %l %u %t \"%r\" %s %b %<D:%>D %{usercpu}n %{systemcpu}n \"%{Referer}i\" \"%{User-Agent}i\" %P %X %{UNIQUE_ID}e %{REMOTE_PROXYIP}e %{HTTPS}x:%{X-Method}i %v %p" butransfer_backend

  # format for SSL specific data
###  LogFormat "%h %t %{UNIQUE_ID}e %{SSL_PROTOCOL}x %{SSL_CIPHER}x %{SSL_CIPHER_USEKEYSIZE}x %{SSL_CIPHER_ALGKEYSIZE}x" ssl


# ####
# format for weblogin specific logging data 
# (use a line like: CustomLog filename weblogin env=WEBLOGINAUTHREF)
#
<IfModule mod_auth_weblogin.c>
  LogFormat "%h %t %{UNIQUE_ID}e %u %{WL_NEEDAUTH}e %{WL_ACTION}e %{CREDSRV}e %{WEBLOGINAUTHREF}e" weblogin
</IfModule>
<IfModule mod_auth_weblogin5.c>
  LogFormat "%h %t %{UNIQUE_ID}e %u %{WL_NEEDAUTH}e %{WL_ACTION}e %{CREDSRV}e %{WEBLOGINAUTHREF}e" weblogin
</IfModule>

# ####
# Format for front-end log which indicates which backend a request went to
# To use this you need to use mod_rewrite and add a ,E=backend_srv:<value>
# to the options.
#
# (use a line like CustomLog filename backend env=backend_srv
###LogFormat "%h %{backend_srv}e %{BALANCER_WORKER_NAME}e %{BALANCER_ROUTE_CHANGED}e %t %{UNIQUE_ID}e %{elapsed}n %D \"%r\"" proxy

# ####
# this log format tells use what extended log info we have for a request
#
LogFormat "%h %{UNIQUE_ID}e %t %s \"%{ERROR_NOTES}e\" \"%{REDIRECT_ERROR_NOTES}e\"" noteslog

# actually we don't use the notes
# \"%{error-notes}n\" \"%{verbose-error-to}n\" noteslog

####
#start deflate
#Adding parameters to invoke mod_deflate according to: INC11617725 
<IfModule mod_deflate.c>
# Insert filters
AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-javascript
AddOutputFilterByType DEFLATE application/x-httpd-php
AddOutputFilterByType DEFLATE application/x-httpd-fastphp
AddOutputFilterByType DEFLATE application/json
AddOutputFilterByType DEFLATE image/svg+xml
AddOutputFilterByType DEFLATE text/javascript

# Drop problematic browsers
BrowserMatch ^Mozilla/4 gzip-only-text/html
BrowserMatch ^Mozilla/4\.0[678] no-gzip
BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

# Make sure proxies dont deliver the wrong content
Header append Vary User-Agent env=!dont-vary
</IfModule>

###CustomLog /var/log/httpd/access_log butransfer_virtual
###ErrorLog /var/log/httpd/error_log
CustomLog /var/log/httpd/weblogin_log weblogin env=WEBLOGINAUTHREF
###CustomLog /var/log/httpd/proxy_log proxy env=backend_srv

# ####
# now we do our server setup
#
# INCLUDE-START: server:wwwv
###Listen 80  -Ghassan
NameVirtualHost *:80
NameVirtualHost *:443

# Trace is enabled by default if there is no TraceEnable off command.
# Trace is a security risk so be careful.

  <IfModule mod_auth_weblogin5.c>
###     WebloginSaveDir /var/log/httpd/wp-app-prod/weblogin-cache/
     WebloginSaveDir /var/cache/weblogin-cache/
  </IfModule>

  # RPAF_MODULE (ips of our front-end servers)
  RPAFenable on
  RPAFproxy_ips 127.0.0.1 10.231.9.24 10.231.9.25 10.231.9.167 10.231.9.168 10.231.8.166 10.231.8.91 10.231.8.92 128.197.26.34 128.197.26.35 10.241.26.106 128.197.27.245 128.197.26.228 128.197.26.229 128.197.27.157 10.241.28.54 10.241.28.62 10.241.26.96 10.241.28.68 10.241.26.99 10.241.26.108 10.231.12.252 10.231.6.38 10.231.8.171 10.231.9.90 10.236.0.6 10.236.1.6 128.197.228.215 128.197.236.6 128.197.27.216 10.231.32.66 10.231.32.67
  #RPAF_IPS
  RPAFsethostname on
  # RPAF_MODULE (end)

# INCLUDE-END: server:wwwv

#ONLY NEED NEXT 2 DIRECTORY DIRECTRIVES FOR APP
<Directory /var/www/cms-prod/current/wp-content/blogs.dir >
AllowOverride None
</Directory>

<Directory /var/www/blogs-prod/current/wp-content/blogs.dir >
AllowOverride None
</Directory>

# ####
# global definitions
#
# MIME type definitions.
######################################################################

# AddType allows you to tweak mime.types without actually editing it, or to
# make certain files to be certain types.
# Format: AddType type/subtype ext1

AddType application/x-powerpoint ppt
AddType text/html htm
AddType x-world/x-vrml  wrl 
AddType application/mac-binhex40 hqx
AddType application/x-director dir
AddType application/json json

# Types for various talker programs (7/14/97 dsmk)
AddType plugin/talker   talk
AddType plugin/listenup ptlk

# RealAudio Server (5/9/96 jme)
AddType audio/x-pn-realaudio ra
AddType audio/x-pn-realaudio ram
AddType audio/x-pn-realaudio-plugin rpm

# Fix for serving up PC binaries (11/15/96 dsmk)
AddType application/octet-stream exe

# Type needed to server netscape javascript config (7/6/98 dsmk)
AddType application/x-ns-proxy-autoconfig proxy

# Word document template (needed by smix)
# -dsmk 9/9/98
AddType application/x-wordtemplate dot

# Microsoft Word format
# -dsmk 9/16/98
AddType application/msword doc

# Microsoft Excel format
# -dsmk 9/18/98
AddType application/vnd.ms-excel xls

# Server-side includes
# -dsmk 2/18/99
#
###AddType text/html .shtml
###AddHandler server-parsed .shtml
# Allow user execute bit to specify that .html files should be parsed for SSI
# -cball 9/29/99
###XBitHack on

# type definitions that disable retrieving .htaccess and .htpasswd
# files
# -dsmk 3/10/99
AddType application/x-disallow-access .htaccess
AddType application/x-disallow-access .htpasswd
Action  application/x-disallow-access /htbin/access-denied.pl

# MP3 encoding
# -dsmk 11/3/99
#
AddType audio/x-mpegurl m3u
AddType audio/mpeg mp3

# shockwave/flash movies
# -dsmk 2/8/2000
AddType application/x-shockwave-flash        .swf
AddType application/futuresplash                 .spl

# Misc audio types (2012/08/15 - Rudi)
AddType audio/ogg ogg
AddType audio/ogg oga
AddType audio/webm webma
# Misc video types (2012/08/15 - Rudi)
AddType video/ogg ogv
AddType video/mp4 mp4
AddType video/webm webm

# For viewing of interactive Mathematica CDF pages (04/22/2013 franco)
AddType application/vnd.wolfram.player nbp
AddType application/vnd.wolfram.mathematica nb
AddType application/vnd.wolfram.cdf cdf
AddType application/vnd.wolfram.cdf.text cdf

# SVG types.
AddType image/svg+xml svg svgz

######################################################################
######################################################################
# global definitions
######################################################################
# Weblogin 5 definitions

# The following commands are no longer used with mod_auth_weblogin5
# WebloginKAuthURI, WebloginOAuthURI, WebloginBothAuthURI 
# WebloginServers, WebloginACLServers
# WebloginRedirect
# -dsmk 6/29/2006

# ####
# File-not-found error document executes a cgi script to determine
# the error page
#
###<IfDefine WWW:ErrorDocument>
###  ErrorDocument 404 /htbin/error/404.pl
###</IfDefine>
###<IfDefine WWW:TestErrorDocument>
###  ErrorDocument 404 /htbin/error/404-test.pl
###</IfDefine>

# DirectoryIndex: Name of the file or files to use as a pre-written HTML
# directory index.  Separate multiple entries with spaces.
DirectoryIndex index.html index.htm index.shtml

# No FancyIndexing in Apache 2.2

# Uncomment the following line to enable Apache's send-asis HTTP file
# feature
# AddHandler send-as-is asis

# If you wish to use server-parsed imagemap files, use
AddHandler imap-file map
# To enable type maps, you might want to use
AddHandler type-map var

# ####
# definitions for particular types of virtual hosts
#

  # proxyhost(`www.bu.edu  www')
  # ONLY FOR THE APP SERVER


#**************************************************************************************
#		P O R T   8 0   ( H T T P )   V I R T U A L   H O S T I N G
#**************************************************************************************
  <VirtualHost *:80>
    ServerName www.bu.edu
    ServerAlias www ${HTTP_HOST}

    # Try redirecting all http to https, as desired in INC12524335:
    # Cause 301 to be returned to the browser with an https version of the URL.
    # Upon final conclusion of the request, that https version shows in the browser URL area.
    #Redirect permanent / https://www.bu.edu/
    #------------------------------------------------------------------------------------------
    # This causes processing to stop here: nothing else in this VirtualHost block is processed.
    #------------------------------------------------------------------------------------------

    RewriteEngine on

    # Uncomment these for port 80 rewrite processing to be logged:
###    RewriteLog /var/log/httpd/rewrite_log
###    RewriteLogLevel 6

# Pull our Shibboleth Location and RewriteRule directives into this VirtualHost
# from our file which by default participates in Apache mainline.
Include conf.d/shib.sp.conf

    RewriteRule ^/server/(.*)$ /server/$1 [L,PT]
    
#  AddType application/x-httpd-php .php
  
  DocumentRoot /var/www/cms-prod/current

# Accommodate personal "sandboxes", such as adamzp.cms-devl.bu.edu
RewriteCond %{HTTP_HOST} ([0-9a-zA-Z\-]+)\.cms-devl\.bu\.edu$
RewriteRule ^/var/www/sandboxes/([0-9a-zA-Z\-_]+)/current(/.*)$ $2 

RewriteCond %{HTTP_HOST} ^([0-9a-zA-Z\-]+)\.cms-prod\.bu\.edu$
RewriteRule ^/+(.*)$ /var/www/sandboxes/%1/current/$1 [L]
# Further down there is a corresponding    <Directory /var/www/sandboxes >

# Blogs theme and include content found in BLOG_DOC_ROOT=/var/www/blogs-prod/current
RewriteCond %{HTTP_HOST} ^blogs(-[a-zA-Z0-9]+)?\.bu\.edu$ [NC]
RewriteRule ^/var/www/blogs-prod/current(/.*)$ $1

RewriteCond %{HTTP_HOST} ^blogs(-[a-zA-Z0-9]+)?\.bu\.edu$ [NC]
RewriteRule ^/+(.*)$ /var/www/blogs-prod/current/$1 [L]

  <Directory /var/www/cms-prod/current >
    AllowOverride AuthConfig FileInfo Limit Indexes
	FileETag none

	# For Shibboleth via .htaccess:	
	# At least initially, allow from anywhere. (Traffic from front end is
	# seen to come from a variety of IP addresses, in at least syst.)
	Allow from all
	# If not allow from all, then allow only from certain networks:
	#Deny from all
        # internal
	#Allow from 10.0.0.0/8
	# bumc
	#Allow from 155.41.128.0/24
	# bmc
	#Allow from 155.41.0.0/17
	#Allow from 168.122.0.0/16
	#Allow from 128.197.0.0/16

  </Directory>

<Directory /var/www/blogs-prod/current >
    AllowOverride AuthConfig FileInfo Limit Indexes
	FileETag none

	# For Shibboleth via .htaccess:	
	# At least initially, allow from anywhere. (Traffic from front end is
	# seen to come from a variety of IP addresses, in at least syst.)
	Allow from all
	# If not allow from all, then allow only from certain networks:
	#Deny from all
	# internal
	#Allow from 10.0.0.0/8
	# bumc
	#Allow from 155.41.128.0/24
	# bmc
	#Allow from 155.41.0.0/17
	#Allow from 168.122.0.0/16
	#Allow from 128.197.0.0/16

  </Directory>

# Directory for personal "sandboxes". Works with rewrite directives coded earlier.
  <Directory /var/www/sandboxes >
    AllowOverride AuthConfig FileInfo Limit Indexes Options=php_value
    FileETag none

	# For Shibboleth via .htaccess:	
	# At least initially, allow from anywhere. (Traffic from front end is
	# seen to come from a variety of IP addresses, in at least syst.)
	Allow from all
	# If not allow from all, then allow only from certain networks:
	#Deny from all
	# internal
	#Allow from 10.0.0.0/8
	# bumc
	#Allow from 155.41.128.0/24
	# bmc
	#Allow from 155.41.0.0/17
	#Allow from 168.122.0.0/16
	#Allow from 128.197.0.0/16

  </Directory>
    
  </VirtualHost>
# end of port 80 VirtualHost


#**************************************************************************************
#	P O R T   4 4 3   ( H T T P S / S S L )   V I R T U A L   H O S T I N G
#**************************************************************************************
# What's in here is all the substance that has been in the port 80 VirtualHost, plus
# the essentials of what ssl.conf's 443 does.
  <VirtualHost *:443>
    ServerName www.bu.edu
    ServerAlias www ${HTTP_HOST}
    
    #_________________________As in ssl.conf________________________________
    # 2022-03-16 rpitkin commented next two lines out per INC13472498
    # ErrorLog logs/ssl_error_log
    # TransferLog logs/ssl_access_log
    LogLevel warn
    SSLEngine on
    SSLProtocol all -SSLv2
    SSLCipherSuite DEFAULT:!EXP:!SSLv2:!DES:!IDEA:!SEED:+3DES
    SSLCertificateFile /etc/pki/tls/certs/localhost.crt
    SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
    #
    # Do not throw a 403 error if the client does not support SNI; instead, they
    # will be redirected to the SSL site defined first.
    SSLStrictSNIVHostCheck off
    
    # The following line prevents a type of content injection attack
    # that would allow URLs like https://www.bu.edu/%2f%20Testing
    # -- bfenster 2022-05-24
    AllowEncodedSlashes NoDecode

    RewriteEngine on
    # Uncomment these for port 443 rewrite processing to be logged:
    # RewriteLog /var/log/httpd/rewrite_log
    # RewriteLogLevel 6
    #--------------------Bottom of ssl.conf adoptions_________________________

# Pull our Shibboleth Location and RewriteRule directives into this VirtualHost
# from our file which by default participates in Apache mainline.
Include conf.d/shib.sp.conf

    RewriteRule ^/server/(.*)$ /server/$1 [L,PT]
    
#  AddType application/x-httpd-php .php
  
  DocumentRoot /var/www/cms-prod/current

# Accommodate personal "sandboxes", such as adamzp.cms-devl.bu.edu
RewriteCond %{HTTP_HOST} ([0-9a-zA-Z\-]+)\.cms-devl\.bu\.edu$
RewriteRule ^/var/www/sandboxes/([0-9a-zA-Z\-_]+)/current(/.*)$ $2 

RewriteCond %{HTTP_HOST} ^([0-9a-zA-Z\-]+)\.cms-prod\.bu\.edu$
RewriteRule ^/+(.*)$ /var/www/sandboxes/%1/current/$1 [L]
# Further down there is a corresponding    <Directory /var/www/sandboxes >

# Blogs theme and include content found in BLOG_DOC_ROOT=/var/www/blogs-prod/current
RewriteCond %{HTTP_HOST} ^blogs(-[a-zA-Z0-9]+)?\.bu\.edu$ [NC]
RewriteRule ^/var/www/blogs-prod/current(/.*)$ $1

RewriteCond %{HTTP_HOST} ^blogs(-[a-zA-Z0-9]+)?\.bu\.edu$ [NC]
RewriteRule ^/+(.*)$ /var/www/blogs-prod/current/$1 [L]

  <Directory /var/www/cms-prod/current >
    AllowOverride AuthConfig FileInfo Limit Indexes
	FileETag none

	# For Shibboleth via .htaccess:	
	# At least initially, allow from anywhere. (Traffic from front end is
	# seen to come from a variety of IP addresses, in at least syst.)
	Allow from all
	# If not allow from all, then allow only from certain networks:
	#Deny from all
        # internal
	#Allow from 10.0.0.0/8
	# bumc
	#Allow from 155.41.128.0/24
	# bmc
	#Allow from 155.41.0.0/17
	#Allow from 168.122.0.0/16
	#Allow from 128.197.0.0/16

  </Directory>

<Directory /var/www/blogs-prod/current >
    AllowOverride AuthConfig FileInfo Limit Indexes
	FileETag none

	# For Shibboleth via .htaccess:	
	# At least initially, allow from anywhere. (Traffic from front end is
	# seen to come from a variety of IP addresses, in at least syst.)
	Allow from all
	# If not allow from all, then allow only from certain networks:
	#Deny from all
	# internal
	#Allow from 10.0.0.0/8
	# bumc
	#Allow from 155.41.128.0/24
	# bmc
	#Allow from 155.41.0.0/17
	#Allow from 168.122.0.0/16
	#Allow from 128.197.0.0/16

  </Directory>

# Directory for personal "sandboxes". Works with rewrite directives coded earlier.
  <Directory /var/www/sandboxes >
    AllowOverride AuthConfig FileInfo Limit Indexes Options=php_value
    FileETag none

	# For Shibboleth via .htaccess:	
	# At least initially, allow from anywhere. (Traffic from front end is
	# seen to come from a variety of IP addresses, in at least syst.)
	Allow from all
	# If not allow from all, then allow only from certain networks:
	#Deny from all
	# internal
	#Allow from 10.0.0.0/8
	# bumc
	#Allow from 155.41.128.0/24
	# bmc
	#Allow from 155.41.0.0/17
	#Allow from 168.122.0.0/16
	#Allow from 128.197.0.0/16

  </Directory>

  </VirtualHost>
# end of port 443 VirtualHost


  # redirecthost(`www.bu.edu http://www.bu.edu ...')
#  <VirtualHost _default_:*>
#    ServerName www.bu.edu
#    
#    DocumentRoot /var/www/cms-prod/current
#    Redirect / http://www.bu.edu
#    
#    Options None
#  </VirtualHost>



DirectoryIndex index.html index.htm index.shtml index.php
# AddHandler send-as-is asis

#RewriteLogLevel 6

##################################################################
